---
title: Vue 中的key
tags: 学习记录
---

# Vue 中的key

> key的作用：对节点进行标识，相当于身份证号

## key的取值
下面是示例代码：
```html
    <ul>
        <li v-for="(element,index) in personList" :key="element.id">{{index}}-{{ element.name }}-{{ element.age }}</li>
    </ul>
    <!-- 中间代码省略 -->

    <script type="text/javascript">
    const vm = new Vue({
        el: '#demo',
        data: function () {
            return {
                personList: [
                    {
                        id: '001',
                        name: "张三",
                        age: 18
                    },
                    {
                        id: '002',
                        name: "李四",
                        age: 19
                    },
                    {
                        id: '003',
                        name: "王五",
                        age: 20
                    },
                ]
            };
        }
    });
```

> 现在需要实现一个功能：添加一个人
> 实现方法：在methods中添加一个函数，进行添加

页面中增加一个按钮：
```html
<button @click.once="addPerson">添加一个人</button>
```

同时在methods方法中增加如下函数：

```javascript
addPerson(){
	const p = {id:'004',name:'Fred',age:21}
	this.personList.unshift(p); // unshift 加在最前面
}

```

现在保存代码，查看HTML代码中这一段的内容：

```html
<ul>
    <li>0-Fred-21</li>
    <li>1-张三-18</li>
    <li>2-李四-19</li>
    <li>3-王五-20</li>
</ul>
```
> key作为特殊属性，被Vue处理后，HTML代码中没有key了。

这里在代码中使用的是：

>:key="element.id"

如果我们将key改成index，如果在每一个<li>标签后带一个input输入框，并且将自带的三个输入框中填入任意值，我们会发现，

[![huErIH.png](https://z3.ax1x.com/2021/08/26/huErIH.png)](https://imgtu.com/i/huErIH)

[![huEyid.png](https://z3.ax1x.com/2021/08/26/huEyid.png)](https://imgtu.com/i/huEyid)

数据发生了错位。同样，如果不设置key的值，也会导致这样的问题，只有在写element.id（数据的唯一标识）时，才会正常显示。

## 遍历列表时key的作用
在刚才key值等于index的过程中：
> 初始数据->初始虚拟DOM（Vnodes，在内存中）->将虚拟DOM转化为真实DOM（此时用户在真实DOM中输入数据，即用户输入的内容保留在真实DOM中，不会影响虚拟DOM）
> 新的数据->根据新的数据生成新的虚拟DOM（此时新数据的key变为"0",因为我们在插入数据时，将新添加的数据放在了最前面->**通过虚拟DOM对比算法（依赖key)**，如果对比后结果不一致，结果不能复用，对比后结果一样，就可以直接复用->将虚拟DOM转化为真实DOM
> 一句话概括，虚拟DOM对比时，相同的可以复用（注意真实DOM不影响虚拟DOM）

[![huE6JA.png](https://z3.ax1x.com/2021/08/26/huE6JA.png)](https://imgtu.com/i/huE6JA)







<!--more--> 

---

2021年8月26日

