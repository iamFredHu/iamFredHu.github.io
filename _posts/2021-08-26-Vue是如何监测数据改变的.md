---
title: Vue是如何监测数据改变的
tags: 学习记录
---

# 数据监测 

> 为什么有的时候修改数据不好用？

## 引入
```html
<div id="demo">
<h2>学校名称：{{name}}</h2>
    <h2>学校地址：{{address}}</h2>
</div>

<script type="text/javascript">
    const vm = new Vue({
        el: '#demo',
        data: function () {
            return {
                name:'哈工大（深圳）',
                address:'深圳大学城'
            };
        }
    });
</script>
```
> 数据代理：vm.name、vm.address来自vm._data，而vm._data中的数据来自传入的data控制项
> 过程：①加工用户传入的data:{}，加入reactiveGetter和reactiveSetter（响应式，一改就重新解析）； ②vm._data=data   

## Vue Observer（复习时需要重点注意原理）
> Vue通过构造函数Observer来监测数据

```javascript
// 创建一个监视的实例对象，用来监测data中属性的变化
    const obs = new Observer(data)

    function Observer(obj) {
        // 汇总对象所有属性，形成一个数组
        const keys = Object.keys(obj)
        // 遍历
        keys.forEach((k) => {
            Object.defineProperty(this, k, {
                get() {
                    return obj[k]
                },
                set(val) {
                	console.log('${k}被改了，提示。')
                    obj[k] = val
                }  
            })
        })
    }

```

## Vue.set() 的使用
> 中途在vm._data中加属性，并不会匹配一个getter和setter（setter会影响页面），也不会被加到vm中。
> 例如vm.student在初始化中有name和age两个属性，那么初始时会给这两个属性匹配一个getter和setter，如果使用vm._data.student.gender= "男"语句，此时不会正常被添加（非响应式）。
> 如何解决这个问题？——Vue.set()

```javascript
	// Vue.set(target, key, val)
	
	Vue.set(vm.student,'gender','男')
```
此时我们后添加的gender属性就成为了响应式了，与之前定义的属性一致

> vm.$set()方法：与Vue.set()效果一致

```javascript
vm.$set(vm.student,'gender','男')
```

<!--more--> 

---

2021年8月26日

